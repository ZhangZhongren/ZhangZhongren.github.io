<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>taro 自学手记 | zzr</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.91d62cf7.js" as="script"><link rel="preload" href="/assets/js/2.06be43ef.js" as="script"><link rel="preload" href="/assets/js/7.103f5d3f.js" as="script"><link rel="prefetch" href="/assets/js/10.e5107a41.js"><link rel="prefetch" href="/assets/js/11.604c2d4a.js"><link rel="prefetch" href="/assets/js/12.5a64ef9d.js"><link rel="prefetch" href="/assets/js/13.1bb9432f.js"><link rel="prefetch" href="/assets/js/14.f5c22324.js"><link rel="prefetch" href="/assets/js/15.e20e2825.js"><link rel="prefetch" href="/assets/js/16.13bee770.js"><link rel="prefetch" href="/assets/js/17.3a4ae192.js"><link rel="prefetch" href="/assets/js/18.cc5d35d1.js"><link rel="prefetch" href="/assets/js/19.4dec0e9c.js"><link rel="prefetch" href="/assets/js/20.497e2c48.js"><link rel="prefetch" href="/assets/js/21.9a320905.js"><link rel="prefetch" href="/assets/js/22.dfd8bd24.js"><link rel="prefetch" href="/assets/js/23.08cd3607.js"><link rel="prefetch" href="/assets/js/24.e0a529a2.js"><link rel="prefetch" href="/assets/js/25.6c526984.js"><link rel="prefetch" href="/assets/js/26.69384b5f.js"><link rel="prefetch" href="/assets/js/27.73bb2c9b.js"><link rel="prefetch" href="/assets/js/28.059d0a3f.js"><link rel="prefetch" href="/assets/js/29.06def4be.js"><link rel="prefetch" href="/assets/js/3.d474d6fc.js"><link rel="prefetch" href="/assets/js/30.4b00a1d4.js"><link rel="prefetch" href="/assets/js/31.f40db05e.js"><link rel="prefetch" href="/assets/js/32.fe513da5.js"><link rel="prefetch" href="/assets/js/33.12307387.js"><link rel="prefetch" href="/assets/js/34.bd12d429.js"><link rel="prefetch" href="/assets/js/35.c3a3c798.js"><link rel="prefetch" href="/assets/js/36.015e3300.js"><link rel="prefetch" href="/assets/js/37.af9d5c2f.js"><link rel="prefetch" href="/assets/js/38.8c844034.js"><link rel="prefetch" href="/assets/js/39.16abb1fd.js"><link rel="prefetch" href="/assets/js/4.d56c28ed.js"><link rel="prefetch" href="/assets/js/40.8aa5b1ac.js"><link rel="prefetch" href="/assets/js/41.39eeea6e.js"><link rel="prefetch" href="/assets/js/42.ba7a8d5c.js"><link rel="prefetch" href="/assets/js/43.040943fa.js"><link rel="prefetch" href="/assets/js/44.94c8f256.js"><link rel="prefetch" href="/assets/js/45.a4bde81b.js"><link rel="prefetch" href="/assets/js/5.6a1ea478.js"><link rel="prefetch" href="/assets/js/6.52d7f34d.js"><link rel="prefetch" href="/assets/js/8.a66117ba.js"><link rel="prefetch" href="/assets/js/9.94bb256c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">zzr</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/js/" class="nav-link router-link-active">
  js
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/nuxt/" class="nav-link">
  nuxt
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/codereview/" class="nav-link">
  编码规范
</a></div><div class="nav-item"><a href="/question/" class="nav-link">
  问题收录
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/js/" class="nav-link router-link-active">
  js
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue
</a></div><div class="nav-item"><a href="/webpack/" class="nav-link">
  webpack
</a></div><div class="nav-item"><a href="/nuxt/" class="nav-link">
  nuxt
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/codereview/" class="nav-link">
  编码规范
</a></div><div class="nav-item"><a href="/question/" class="nav-link">
  问题收录
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/js/" aria-current="page" class="sidebar-link">js</a></li><li><a href="/js/array.html" class="sidebar-link">数组</a></li><li><a href="/js/date.html" class="sidebar-link">日期</a></li><li><a href="/js/function.html" class="sidebar-link">函数</a></li><li><a href="/js/npmScript.html" class="sidebar-link">npmScript</a></li><li><a href="/js/regexp.html" class="sidebar-link">regexp</a></li><li><a href="/js/axios.html" class="sidebar-link">axios</a></li><li><a href="/js/fetch.html" class="sidebar-link">fetch</a></li><li><a href="/js/taro.html" aria-current="page" class="active sidebar-link">taro</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/taro.html#taro-多端的区分" class="sidebar-link">taro 多端的区分</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-使用-微信的-jssdk" class="sidebar-link">taro 使用 微信的 jssdk</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-配置-history" class="sidebar-link">taro 配置 history</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#setstate-赋值之后-立即获取-state中的数据获取不到" class="sidebar-link">setState 赋值之后 立即获取 state中的数据获取不到</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#获取地位置" class="sidebar-link">获取地位置</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#小程序-canvas-尺寸兼容问题" class="sidebar-link">小程序 canvas 尺寸兼容问题</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#小程序实现-s-标签效果" class="sidebar-link">小程序实现 s 标签效果</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-canvastotempfilepath-方法-放在组件内部-也会报错-canvasid-do-not-exist" class="sidebar-link">taro canvasToTempFilePath 方法 放在组件内部 也会报错 canvasId do not exist</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-小程序发布提示用户更新" class="sidebar-link">taro 小程序发布提示用户更新</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#开发环境调试-识别二维码" class="sidebar-link">开发环境调试 识别二维码</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-获取小程序分享的scene" class="sidebar-link">taro 获取小程序分享的scene</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-设置单个页面的顶部背景色-和-文字颜色" class="sidebar-link">taro 设置单个页面的顶部背景色 和 文字颜色</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#小程序登录流程梳理" class="sidebar-link">小程序登录流程梳理</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-ui-阻止冒泡问题" class="sidebar-link">taro ui 阻止冒泡问题</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#开箱可用的保存图片功能" class="sidebar-link">开箱可用的保存图片功能</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-组件调用" class="sidebar-link">taro 组件调用</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#taro-引用-阿拉丁小程序" class="sidebar-link">Taro 引用 阿拉丁小程序</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#canvas生成海报-在有些安卓机上出现黑背景" class="sidebar-link">canvas生成海报 在有些安卓机上出现黑背景</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#兼容问题" class="sidebar-link">兼容问题</a></li><li class="sidebar-sub-header"><a href="/js/taro.html#image-之间的-间距问题" class="sidebar-link">Image 之间的 间距问题</a></li></ul></li><li><a href="/js/jsFunc.html" class="sidebar-link">jsFunc</a></li><li><a href="/js/loadFile.html" class="sidebar-link">文件下载</a></li><li><a href="/js/event.html" class="sidebar-link">事件</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="taro-自学手记"><a href="#taro-自学手记" class="header-anchor">#</a> taro 自学手记</h1> <h2 id="taro-多端的区分"><a href="#taro-多端的区分" class="header-anchor">#</a> taro 多端的区分</h2> <p>根据打包命令的参数进行区分,区分方式如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARO_ENV</span> <span class="token operator">===</span> <span class="token string">'h5'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// h5</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARO_ENV</span> <span class="token operator">===</span> <span class="token string">'weapp'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  小程序</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下是 taro 的打包命令</p> <div class="language- extra-class"><pre class="language-text"><code>    &quot;scripts&quot;: {
    &quot;build:weapp&quot;: &quot;taro build --type weapp&quot;,
    &quot;build:swan&quot;: &quot;taro build --type swan&quot;,
    &quot;build:alipay&quot;: &quot;taro build --type alipay&quot;,
    &quot;build:tt&quot;: &quot;taro build --type tt&quot;,
    &quot;build:h5&quot;: &quot;taro build --type h5&quot;,
    &quot;build:rn&quot;: &quot;taro build --type rn&quot;,
    &quot;dev:weapp&quot;: &quot;npm run build:weapp -- --watch&quot;,
    &quot;dev:swan&quot;: &quot;npm run build:swan -- --watch&quot;,
    &quot;dev:alipay&quot;: &quot;npm run build:alipay -- --watch&quot;,
    &quot;dev:tt&quot;: &quot;npm run build:tt -- --watch&quot;,
    &quot;dev:h5&quot;: &quot;npm run build:h5 -- --watch&quot;,
    &quot;dev:rn&quot;: &quot;npm run build:rn -- --watch&quot;
  },
</code></pre></div><h2 id="taro-使用-微信的-jssdk"><a href="#taro-使用-微信的-jssdk" class="header-anchor">#</a> taro 使用 微信的 jssdk</h2> <p>taro支持npm包，所以就在taro中引用微信 jssdk 的包</p> <blockquote><p>weixin-js-sdk</p></blockquote> <p>这里有两种使用方式
1、在需要调用的页面引用；
2、在app.js中引用并注册到app中 在需要使用的页面引入app</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARO_ENV</span> <span class="token operator">===</span> <span class="token string">'h5'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> wx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'weixin-js-sdk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="taro-配置-history"><a href="#taro-配置-history" class="header-anchor">#</a> taro 配置 history</h2> <p><a href="http://taro-docs.jd.com/taro/docs/config-detail.html#h5router" target="_blank" rel="noopener noreferrer">编译配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>publicPath 只能是 / 不可以是 ./</p></blockquote> <h2 id="setstate-赋值之后-立即获取-state中的数据获取不到"><a href="#setstate-赋值之后-立即获取-state中的数据获取不到" class="header-anchor">#</a> setState 赋值之后 立即获取 state中的数据获取不到</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'zzr'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 得到的值不是 zzr</span>
</code></pre></div><p>解决方案</p> <p>·1 利用 setState 第二个参数（回调函数做处理）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">,</span> <span class="token string">'zzr'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>·2 利用 es6 的 async await</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'zzr'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>·3 利用 setTimeout</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'zzr'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="获取地位置"><a href="#获取地位置" class="header-anchor">#</a> 获取地位置</h2> <ol><li><p>下载 <a href="https://lbs.qq.com/product/miniapp/jssdk/" target="_blank" rel="noopener noreferrer">腾讯位置服务 小程序JS SDK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>申请秘钥</p></li> <li><p>封装 getLocation.js 代码如下</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> QQMapWX <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./qqmap-wx-jssdk.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> qqmapsdk<span class="token punctuation">;</span>
qqmapsdk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QQMapWX</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">''</span> <span class="token comment">//这里自己的key秘钥进行填充</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getlocation</span> <span class="token punctuation">(</span><span class="token parameter">call</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// res.authSetting['scope.userLocation'] == undefined    表示 初始化进入该页面</span>
          <span class="token comment">// res.authSetting['scope.userLocation'] == false    表示 非初始化进入该页面,且未授权</span>
          <span class="token comment">// res.authSetting['scope.userLocation'] == true    表示 地理位置授权</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'请求授权当前位置'</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span> <span class="token string">'需要获取您的地理位置，请确认授权'</span><span class="token punctuation">,</span>
              <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cancel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    title<span class="token operator">:</span> <span class="token string">'拒绝授权'</span><span class="token punctuation">,</span>
                    icon<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
                    duration<span class="token operator">:</span> <span class="token number">1000</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  wx<span class="token punctuation">.</span><span class="token function">openSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dataAu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>dataAu<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">&quot;scope.userLocation&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                          title<span class="token operator">:</span> <span class="token string">'授权成功'</span><span class="token punctuation">,</span>
                          icon<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
                          duration<span class="token operator">:</span> <span class="token number">1000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token comment">//再次授权，调用wx.getLocation的API</span>
                        
                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                          title<span class="token operator">:</span> <span class="token string">'授权失败'</span><span class="token punctuation">,</span>
                          icon<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
                          duration<span class="token operator">:</span> <span class="token number">1000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//调用wx.getLocation的API</span>
            <span class="token function">getLocation</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//调用wx.getLocation的API</span>
            <span class="token function">getLocation</span><span class="token punctuation">(</span>call<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getLocation</span> <span class="token punctuation">(</span><span class="token parameter">call</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'wgs84'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> latitude <span class="token operator">=</span> res<span class="token punctuation">.</span>latitude
        <span class="token keyword">var</span> longitude <span class="token operator">=</span> res<span class="token punctuation">.</span>longitude
        <span class="token keyword">var</span> speed <span class="token operator">=</span> res<span class="token punctuation">.</span>speed
        <span class="token keyword">var</span> accuracy <span class="token operator">=</span> res<span class="token punctuation">.</span>accuracy<span class="token punctuation">;</span>
        <span class="token function">getLocal</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">,</span>call<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log('fail' + JSON.stringify(res))</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
 <span class="token keyword">function</span> <span class="token function">getLocal</span><span class="token punctuation">(</span><span class="token parameter">latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">,</span>call</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  qqmapsdk<span class="token punctuation">.</span><span class="token function">reverseGeocoder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    location<span class="token operator">:</span> <span class="token punctuation">{</span>
      latitude<span class="token operator">:</span> latitude<span class="token punctuation">,</span>
      longitude<span class="token operator">:</span> longitude
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> province <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>ad_info<span class="token punctuation">.</span>province
      <span class="token keyword">let</span> city <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>ad_info<span class="token punctuation">.</span>city
     
      call <span class="token operator">&amp;&amp;</span> <span class="token function">call</span><span class="token punctuation">(</span>province<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> getlocation<span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>调用</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getlocation</span> <span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="小程序-canvas-尺寸兼容问题"><a href="#小程序-canvas-尺寸兼容问题" class="header-anchor">#</a> 小程序 canvas 尺寸兼容问题</h2> <blockquote><p>小程序的单位是 rpx 已经做好了适配 但是canvas 是给定的 px 这里不能进行自动的适配所以就想到了如下的方案</p></blockquote> <p>公式：</p> <ol><li>计算canvas宽</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>画布宽 = windowWidth * 画布设计稿宽 / 设计稿满屏宽</p></div> <ol start="2"><li>元素宽计算</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>元素所求宽 = 元素设计稿宽度 / 设计稿总宽 * 第一步所求出画布宽</p></div> <ol start="3"><li>计算出设计稿1px宽度代表的实际值</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>baseWidth = 元素所求宽 / 元素设计稿的宽度</p></div> <ol start="4"><li>计算需要使用的宽度和高度(宽度和高度统一使用宽度进行计算)</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getWidth</span> <span class="token punctuation">(</span><span class="token parameter">width</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> baseWidth <span class="token operator">*</span> width
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getHeight</span> <span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> baseWidth <span class="token operator">*</span> height
<span class="token punctuation">}</span>
</code></pre></div><h2 id="小程序实现-s-标签效果"><a href="#小程序实现-s-标签效果" class="header-anchor">#</a> 小程序实现 s 标签效果</h2> <div class="language-css extra-class"><pre class="language-css"><code><span class="token property">text-decoration</span><span class="token punctuation">:</span>line-through<span class="token punctuation">;</span>
</code></pre></div><h2 id="taro-canvastotempfilepath-方法-放在组件内部-也会报错-canvasid-do-not-exist"><a href="#taro-canvastotempfilepath-方法-放在组件内部-也会报错-canvasid-do-not-exist" class="header-anchor">#</a> taro canvasToTempFilePath 方法 放在组件内部 也会报错 canvasId do not exist</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>canvas 的标签不放在组件内部进行封装</p></div> <h2 id="taro-小程序发布提示用户更新"><a href="#taro-小程序发布提示用户更新" class="header-anchor">#</a> taro 小程序发布提示用户更新</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在app.js里写下以下代码</span>
  <span class="token function">onLaunch</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span><span class="token function">canIUse</span><span class="token punctuation">(</span><span class="token string">'getUpdateManager'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> updateManager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getUpdateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      updateManager<span class="token punctuation">.</span><span class="token function">onCheckForUpdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>hasUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          updateManager<span class="token punctuation">.</span><span class="token function">onUpdateReady</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'更新提示'</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span> <span class="token string">'新版本已经准备好，是否重启应用？'</span><span class="token punctuation">,</span>
              <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  updateManager<span class="token punctuation">.</span><span class="token function">applyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          updateManager<span class="token punctuation">.</span><span class="token function">onUpdateFailed</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'已经有新版本了哟~'</span><span class="token punctuation">,</span>
              content<span class="token operator">:</span> <span class="token string">'新版本已经上线啦~，请您删除当前小程序，重新搜索打开哟~'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>t
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="开发环境调试-识别二维码"><a href="#开发环境调试-识别二维码" class="header-anchor">#</a> 开发环境调试 识别二维码</h2> <p><img src="/assets/img/edit.5a50f435.png" alt="An image"></p> <p>选择 生成好了的小程序二维码</p> <h2 id="taro-获取小程序分享的scene"><a href="#taro-获取小程序分享的scene" class="header-anchor">#</a> taro 获取小程序分享的scene</h2> <blockquote><p>this.$router.params.scene</p></blockquote> <p>一般用 &amp; = 方式拼接 scene参数</p> <p>这里放一个解析参数的函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getScene</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>params<span class="token punctuation">.</span>scene
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> array <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
      obj<span class="token punctuation">[</span>array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> obj
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="taro-设置单个页面的顶部背景色-和-文字颜色"><a href="#taro-设置单个页面的顶部背景色-和-文字颜色" class="header-anchor">#</a> taro 设置单个页面的顶部背景色 和 文字颜色</h2> <div class="language-js extra-class"><pre class="language-js"><code>config <span class="token operator">=</span> <span class="token punctuation">{</span>
  navigationBarTitleText<span class="token operator">:</span> <span class="token string">'个人中心'</span><span class="token punctuation">,</span>
  navigationBarBackgroundColor<span class="token operator">:</span> <span class="token string">'#FF3C00'</span><span class="token punctuation">,</span>
  navigationBarTextStyle<span class="token operator">:</span> <span class="token string">'white'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="小程序登录流程梳理"><a href="#小程序登录流程梳理" class="header-anchor">#</a> 小程序登录流程梳理</h2> <p>微信改版过后 获取用户信息和手机号必须引导用户点击button的方式得到</p> <p>获取用户信息</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>getUserInfo<span class="token punctuation">'</span></span> <span class="token attr-name">bindgetuserinfo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getUserInfo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getUserInfo</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>获取用户手机号</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>getPhoneNumber<span class="token punctuation">'</span></span> <span class="token attr-name">bindgetphonenumber</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getPhoneNumber<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getPhoneNumber</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>用户自动登录流程</p> <p>小程序提供 wx.loing() 方法 这个方法只有 通过按钮引导用户授权之后 才可以成功的调用</p> <p>判断用户是否 授权</p> <div class="language-js extra-class"><pre class="language-js"><code>Taro<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userInfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//未授权</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 授权</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>未授权引导用户授权 拿到 加密字符串 解密拿到 openid  unionid 等信息</p> <p>已经授权的 通过 wx.login() 获取到code  通过code 获得 用信息 解密拿到 openid  unionid 等信息</p> <h2 id="taro-ui-阻止冒泡问题"><a href="#taro-ui-阻止冒泡问题" class="header-anchor">#</a> taro ui 阻止冒泡问题</h2> <blockquote><p>taro ui 的标签 不支持 阻止冒泡处理  需要用原声的标签包裹一层</p></blockquote> <h2 id="开箱可用的保存图片功能"><a href="#开箱可用的保存图片功能" class="header-anchor">#</a> 开箱可用的保存图片功能</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadImg</span> <span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果没有则获取授权</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> src<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.writePhotosAlbum'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          scope<span class="token operator">:</span> <span class="token string">'scope.writePhotosAlbum'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">saveImageToPhotosAlbum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              filePath<span class="token operator">:</span> src<span class="token punctuation">,</span>
              <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  title<span class="token operator">:</span> <span class="token string">'保存成功'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  title<span class="token operator">:</span> <span class="token string">'保存失败'</span><span class="token punctuation">,</span>
                  icon<span class="token operator">:</span> <span class="token string">'none'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有则直接保存</span>
        wx<span class="token punctuation">.</span><span class="token function">saveImageToPhotosAlbum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          filePath<span class="token operator">:</span> src<span class="token punctuation">,</span>
          <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'保存成功'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'保存失败'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'none'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="taro-组件调用"><a href="#taro-组件调用" class="header-anchor">#</a> taro 组件调用</h2> <p>1、组件名必须首字母大写，否则在组件中 props 字段会一直是一个空对象
2、参数校验</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>组件定义模版名称<span class="token punctuation">}</span><span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    show<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>bool<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
    onHandleToggleShow<span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3、子组件调用父组件的方法必须以 on 开头</p> <h2 id="taro-引用-阿拉丁小程序"><a href="#taro-引用-阿拉丁小程序" class="header-anchor">#</a> Taro 引用 阿拉丁小程序</h2> <p>在 app 引用 ald-start 报错 栈溢出了</p> <p>解决方案 在每一个 模版中单独引用</p> <h2 id="canvas生成海报-在有些安卓机上出现黑背景"><a href="#canvas生成海报-在有些安卓机上出现黑背景" class="header-anchor">#</a> canvas生成海报 在有些安卓机上出现黑背景</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>解决方案： 在黑背景的地方 手动画一下 #fff的背景色就可以解决</p></div> <h2 id="兼容问题"><a href="#兼容问题" class="header-anchor">#</a> 兼容问题</h2> <p>最近一次微信更新
multiSelector 类型的 piker 第一次唤起改变某一列之后onColumnChange 不生效 点击确定之后才会生效</p> <p>问题原因：没有给默认的value值</p> <p>解决办法： value 赋值（Array）初始数据</p> <h2 id="image-之间的-间距问题"><a href="#image-之间的-间距问题" class="header-anchor">#</a> Image 之间的 间距问题</h2> <ol><li><p>给Image的父元素设置font-size: 0;</p></li> <li><p>给 Image 设置 float: left; 父元素 overflow: hidden;</p></li> <li><p>设置图片的垂直对齐方式</p></li></ol> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.my-img</span> <span class="token punctuation">{</span>
    <span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>
    <span class="token property">vertical-align</span><span class="token punctuation">:</span> text-top<span class="token punctuation">;</span>
    <span class="token property">vertical-align</span><span class="token punctuation">:</span> bottom<span class="token punctuation">;</span>
    <span class="token property">vertical-align</span><span class="token punctuation">:</span> text-bottom<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li><p>父元素设置 display: flse; flex-direction: column;</p></li> <li><p>如果还有问题给 Image 设置 margin-top: -1px;</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/fetch.html" class="prev">
        fetch
      </a></span> <span class="next"><a href="/js/jsFunc.html">
        jsFunc
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.91d62cf7.js" defer></script><script src="/assets/js/2.06be43ef.js" defer></script><script src="/assets/js/7.103f5d3f.js" defer></script>
  </body>
</html>
